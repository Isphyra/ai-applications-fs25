import gradio as gr
from sklearn.ensemble import RandomForestRegressor
import numpy as np
import pandas as pd
import pickle

# TODO change the file to your own model.
model_filename = "random_forest_regression.pkl"

random_forest_model = RandomForestRegressor()
with open(model_filename, 'rb') as f:
    random_forest_model = pickle.load(f)


    df_bfs_data = pd.read_csv('bfs_municipality_and_tax_data.csv', sep=',', encoding='utf-8')
df_bfs_data['tax_income'] = df_bfs_data['tax_income'].str.replace("'", "").astype(float)

df_bfs_supermarket = pd.read_csv('supermarkets_data_enriched.csv', sep=',', encoding='utf-8')
df_bfs_supermarket = df_bfs_supermarket.dropna()

supermarket_locations = {
    'Aadorf': 4551,
    'Aarau': 4001,
    'Aarburg': 4271,
    'Aarwangen': 321,
    'Abtwil': 3442,
    'Adelboden': 561,
    'Adligenswil': 1051,
    'Adliswil': 131,
    'Aefligen': 401,
    'Aesch': 2761,
    'Aesch BL': 2761,
    'Affoltern am Albis': 2,
    'Aigle': 5401,
    'Airolo': 5061,
    'Allschwil': 2762,
    'Alpnach Dorf': 1401,
    'Altdorf': 1201,
    'Altdorf UR': 1201,
    'Altendorf': 1341,
    'Altstätten': 3251,
    'Altstätten SG': 3251,
    'Amriswil': 4461,
    'Andelfingen': 30,
    'Anzère': 6082,
    'Appenzell': 3101,
    'Arbedo': 5001,
    'Arbon': 4401,
    'Ardon': 6021,
    'Areuse': 6404,
    'Arlesheim': 2763,
    'Arni': 4061,
    'Arzo': 5254,
    'Ascona': 5091,
    'Au': 293,
    'Au SG': 3231,
    'Avenches': 5451,
    'Avry-sur-Matran': 2174,
    'Azmoos': 3276,
    'Baar': 1701,
    'Bachenbülach': 51,
    'Baden': 4021,
    'Balerna': 5242,
    'Balsthal': 2422,
    'Bargen': 302,
    'Basel': 2701,
    'Bassecourt': 6729,
    'Bassersdorf': 52,
    'Bauma': 297,
    'Beckenried': 1501,
    'Belfaux': 2175,
    'Bellach': 2542,
    'Bellwald': 6052,
    'Belp': 861,
    'Belprahon': 681,
    'Benglen': 193,
    'Benken SG': 3312,
    'Bercher': 5512,
    'Berg': 4891,
    'Bergün/Bravuogn': 3544,
    'Bern': 351,
    'Beromünster': 1081,
    'Bertschikon bei Gossau': 115,
    'Bettlach': 2543,
    'Bettmeralp': 6205,
    'Biasca': 5281,
    'Biberist': 2513,
    'Biel VS': 6077,
    'Biel/Bienne': 371,
    'Bilten': 1630,
    'Binningen': 2765,
    'Birsfelden': 2766,
    'Boll': 359,
    'Bolligen': 352,
    'Bonfol': 6775,
    'Bonstetten': 3,
    'Boppelsen': 82,
    'Boswil': 4228,
    'Bottenwil': 4273,
    'Botyre': 6082,
    'Bouveret': 6154,
    'Breil/Brigels': 3981,
    'Breitenbach': 2613,
    'Bremgarten AG': 4063,
    'Bremgarten bei Bern': 353,
    'Brienz BE': 573,
    'Brig': 6002,
    'Broc': 2124,
    'Bronschhofen': 3427,
    'Brugg': 4095,
    'Brunnen': 1364,
    'Brusino Arsizio': 5160,
    'Bubendorf': 2823,
    'Buch am Irchel': 24,
    'Buchrain': 1052,
    'Buchs (SG)': 3271,
    'Buchs AG': 4003,
    'Buchs SG': 3271,
    'Buchs ZH': 83,
    'Buochs': 1502,
    'Burgdorf': 404,
    'Buttikon SZ': 1346,
    'Buttisholz': 1083,
    'Bönigen': 572,
    'Bülach': 53,
    'Büren an der Aare': 383,
    'Büron': 1082,
    'Carouge': 6608,
    'Cevio': 5310,
    'Cham': 1702,
    'Chamoson': 6022,
    'Champagne': 5553,
    'Champéry': 6151,
    'Charmey (Gruyère)': 2163,
    'Chavannes-près-Renens': 5627,
    'Chiasso': 5250,
    'Chur': 3901,
    'Chêne-Bourg': 6613,
    'Clarens': 5886,
    'Coldrerio': 5251,
    'Collombey': 6152,
    'Colombier': 5634,
    'Conthey': 6023,
    'Courgevaux': 2250,
    'Courtepin': 2254,
    'Courtételle': 6710,
    'Cresta/Avers': 3681,
    'Crissier': 5583,
    'Dagmersellen': 1125,
    'Davos': 3851,
    'Degersheim': 3401,
    'Delémont': 6711,
    'Derendingen': 2517,
    'Dielsdorf': 86,
    'Diepoldsau': 3234,
    'Dietikon': 243,
    'Dietlikon': 54,
    'Disentis/Mustér': 3982,
    'Domat/Ems': 3722,
    'Dongio': 5048,
    'Dornach': 2473,
    'Dullikon': 2573,
    'Dättwil': 4021,
    'Döttingen': 4304,
    'Dübendorf': 191,
    'Dürnten': 113,
    'Ebikon': 1054,
    'Ebmatingen': 195,
    'Ebnat-Kappel': 3352,
    'Echallens': 5518,
    'Eclépens': 5482,
    'Effretikon': 296,
    'Egerkingen': 2401,
    'Eggersriet': 3212,
    'Eglisau': 55,
    'Ehrendingen': 4049,
    'Einsiedeln': 1301,
    'Elgg': 294,
    'Elsau': 219,
    'Embrach': 56,
    'Emmen': 1024,
    'Emmenbrücke': 1024,
    'Engelberg': 1402,
    'Entlebuch': 1002,
    'Epalinges': 5584,
    'Erlenbach': 151,
    'Erlinsbach (SO)': 2503,
    'Erlinsbach AG': 4005,
    'Ermatingen': 4646,
    'Ernen': 6056,
    'Erschmatt': 6110,
    'Erstfeld': 1206,
    'Eschenbach': 3342,
    'Eschenbach SG': 3342,
    'Ettingen': 2768,
    'Fahrwangen': 4196,
    'Faido': 5072,
    'Fehraltorf': 172,
    'Feldmeilen': 156,
    'Fiesch': 6057,
    'Fislisbach': 4027,
    'Flawil': 3402,
    'Flums': 3292,
    'Flurlingen': 29,
    'Fontainemelon': 6487,
    'Frauenfeld': 4566,
    'Fribourg': 2196,
    'Frick': 4163,
    'Frutigen': 563,
    'Fällanden': 193,
    'Füllinsdorf': 2825,
    'Gals': 494,
    'Gampel': 6118,
    'Gams': 3272,
    'Gebenstorf': 4029,
    'Gebertingen': 3341,
    'Geneva': 6621,
    'Geneve': 6621,
    'Genève': 6621,
    'Gerlafingen': 2519,
    'Geroldswil': 244,
    'Gerzensee': 866,
    'Gibswil': 114,
    'Giffers': 2294,
    'Gisikon': 1055,
    'Giswil': 1403,
    'Giubiasco': 5002,
    'Givisiez': 2197,
    'Gland': 5721,
    'Glarus': 1632,
    'Glattbrugg': 66,
    'Gockhausen': 191,
    'Goldach': 3213,
    'Goldau': 1362,
    'Gommiswald': 3341,
    'Gossau': 115,
    'Gossau (ZH)': 115,
    'Grabs': 3273,
    'Grand-Lancy': 6628,
    'Grandson': 5561,
    'Greifensee': 194,
    'Grenchen': 2546,
    'Gretzenbach': 2576,
    'Grimisuat': 6263,
    'Grindelwald': 576,
    'Grolley': 2200,
    'Grosshöchstetten': 608,
    'Gränichen': 4006,
    'Grüsch': 3961,
    'Gstaad': 843,
    'Gundetswil': 298,
    'Guntalingen': 292,
    'Gutenswil': 199,
    'Gümligen': 356,
    'Haag (Rheintal)': 3274,
    'Hadlikon': 117,
    'Hagenbuch': 220,
    'Haute-Nendaz': 6024,
    'Heerbrugg': 3231,
    'Heiden': 3032,
    'Hendschiken': 4198,
    'Hergiswil (NW)': 1507,
    'Hergiswil NW': 1507,
    'Herrliberg': 152,
    'Herzogenbuchsee': 979,
    'Hinteregg': 192,
    'Hirzel': 295,
    'Hittnau': 173,
    'Hitzkirch': 1030,
    'Hochdorf': 1031,
    'Hombrechtikon': 153,
    'Horgen': 295,
    'Horgenberg': 295,
    'Horw': 1058,
    'Huttwil': 954,
    'Hägendorf': 2579,
    'Hägglingen': 4068,
    'Hünenberg': 1703,
    'Hünibach': 929,
    'Hütten': 293,
    'Ibach': 1372,
    'Ilanz': 3619,
    'Ilanz/Glion': 3619,
    'Ins': 496,
    'Iseltwald': 582,
    'Ittigen': 362,
    'Jenins': 3952,
    'Jona': 3340,
    'Jonschwil': 3405,
    'Kaiseraugst': 4252,
    'Kaisten': 4169,
    'Kaltbrunn': 3313,
    'Kandersteg': 565,
    'Kappel am Albis': 6,
    'Kerzers': 2265,
    'Kilchberg': 135,
    'Kirchberg BE': 412,
    'Kirchberg SG': 3392,
    'Kleinandelfingen': 33,
    'Kleinlützel': 2619,
    'Klosters': 3871,
    'Kloten': 62,
    'Kollbrunn': 231,
    'Konolfingen': 612,
    'Krattigen': 566,
    'Kreuzlingen': 4671,
    'Kriens': 1059,
    'Kriessern': 3254,
    'Kölliken': 4276,
    'Köniz': 355,
    'Küsnacht': 154,
    'Küssnacht am Rigi': 1331,
    'La Chaux-de-Fonds': 6421,
    'La Conversion': 5606,
    'Lachen': 1344,
    'Lachen SZ': 1344,
    'Landquart': 3955,
    'Langendorf': 2550,
    'Langenthal': 329,
    'Langnau am Albis': 136,
    'Langnau i. E.': 902,
    'Laufen': 2787,
    'Laupen BE': 667,
    'Lausanne': 5586,
    'Le Brassus': 5872,
    'Le Grand-Saconnex': 6623,
    'Le Mont-sur-Lausanne': 5587,
    'Le Sentier': 5872,
    'Leimiswil': 332,
    'Lenggenwil': 3423,
    'Lengnau BE': 387,
    'Lenzburg': 4201,
    'Lenzerheide': 3506,
    'Les Acacias': 6621,
    'Lichtensteig': 3374,
    'Liestal': 2829,
    'Littau': 1061,
    'Locarno': 5113,
    'Lonay': 5638,
    'Losone': 5115,
    'Lostorf': 2493,
    'Lucens': 5675,
    'Lugano': 5192,
    'Lupfig': 4104,
    'Lupsingen': 2830,
    'Luterbach': 2527,
    'Lutry': 5606,
    'Luzern': 1061,
    'Lyss': 306,
    'Léchelles': 2053,
    'Löhningen': 2903,
    'Malters': 1062,
    'Malvaglia': 5050,
    'Marbach SG': 3253,
    'Marly': 2206,
    'Martigny': 6136,
    'Massagno': 5196,
    'Matran': 2208,
    'Matzingen': 4591,
    'Maur': 195,
    'Mehlsecken': 1140,
    'Meilen': 156,
    'Melano': 5197,
    'Melchsee-Frutt': 1404,
    'Mellingen': 4033,
    'Mels': 3293,
    'Mendrisio': 5254,
    'Menziken': 4139,
    'Menzingen': 1704,
    'Merenschwand': 4234,
    'Mettmenstetten': 9,
    'Meyrin': 6630,
    'Mollis': 1630,
    'Montezillon': 6413,
    'Montreux': 5886,
    'Moosseedorf': 544,
    'Morbio Inferiore': 5257,
    'Morcote': 5203,
    'Morges': 5642,
    'Moudon': 5678,
    'Moutier': 700,
    'Muntelier': 2275,
    'Murgenthal': 4279,
    'Muri (AG)': 4236,
    'Muri AG': 4236,
    'Muri b. Bern': 356,
    'Muri bei Bern': 356,
    'Murten': 2275,
    'Murten/Morat': 2275,
    'Muttenz': 2770,
    'Männedorf': 155,
    'Möhlin': 4254,
    'Mörschwil': 3214,
    'Müllheim Dorf': 4831,
    'Münchenbuchsee': 546,
    'Münchenstein': 2769,
    'Münchwilen': 4746,
    'Münsingen': 616,
    'Münster VS': 6077,
    'Müstair': 3847,
    'Nant': 2284,
    'Neuchâtel': 6458,
    'Neuenhof': 4034,
    'Neuenkirch': 1093,
    'Neyruz FR': 2211,
    'Nidau': 743,
    'Niederbipp': 981,
    'Niederglatt': 89,
    'Niedergösgen': 2495,
    'Niederhasli': 90,
    'Niederlenz': 4204,
    'Niederscherli': 355,
    'Niederurnen': 1630,
    'Niederweningen': 91,
    'Nottwil': 1094,
    'Nussbaumen AG': 4038,
    'Nyon': 5724,
    'Näfels': 1630,
    'Nürensdorf': 64,
    'Oberbalm': 357,
    'Oberbipp': 983,
    'Oberburg': 418,
    'Oberengstringen': 245,
    'Oberentfelden': 4010,
    'Oberriet': 3254,
    'Oberweningen': 93,
    'Oberwil BL': 2771,
    'Oberägeri': 1706,
    'Oensingen': 2407,
    'Oetwil am See': 157,
    'Oey': 762,
    'Oftringen': 4280,
    'Olten': 2581,
    'Onex': 6631,
    'Opfikon': 66,
    'Ormalingen': 2856,
    'Orsières': 6034,
    'Ossingen': 37,
    'Ostermundigen': 363,
    'Ottenbach': 11,
    'Penthalaz': 5495,
    'Petit-Lancy': 6628,
    'Pfungen': 224,
    'Pfäffikon': 1322,
    'Pfäffikon ZH': 177,
    'Pieterlen': 392,
    'Porrentruy': 6800,
    'Port': 745,
    'Pratteln': 2831,
    'Prilly': 5589,
    'Pully': 5590,
    'RENENS': 5591,
    'Rafz': 67,
    'Rapperswil': 3340,
    'Rapperswil SG': 3340,
    'Rapperswil-Jona': 3340,
    'Reckingen': 6077,
    'Regensdorf': 96,
    'Reichenburg': 1345,
    'Reinach BL': 2773,
    'Renens': 5591,
    'Rheinfelden': 4258,
    'Richterswil': 138,
    'Rickenbach (LU)': 1097,
    'Rickenbach Sulz': 225,
    'Riddes': 6139,
    'Riederalp': 6181,
    'Riedholz': 2554,
    'Riehen': 2703,
    'Riniken': 4111,
    'Roche (VD)': 5413,
    'Roggwil': 337,
    'Rohrbach': 338,
    'Rolle': 5861,
    'Romanshorn': 4436,
    'Rombach': 4008,
    'Romont (FR)': 2096,
    'Romont FR': 2096,
    'Root': 1065,
    'Rorbas': 68,
    'Rorschach': 3215,
    'Rothenburg': 1040,
    'Rothrist': 4282,
    'Rotkreuz': 1707,
    'Rudolfstetten': 4075,
    'Russikon': 178,
    'Ruswil': 1098,
    'Rümlang': 97,
    'Rüschlikon': 139,
    'Rüti': 118,
    'Rüti (ZH)': 118,
    'Saanenmöser': 843,
    'Saas-Fee': 6290,
    'Sachseln': 1406,
    'Safenwil': 4283,
    'Saillon': 6140,
    'Saint-Légier-La Chiésaz': 5888,
    'Salgesch': 6113,
    'Samedan': 3786,
    'Sankt Gallen': 3203,
    "Sant'Antonino": 5017,
    'Sarnen': 1407,
    'Savièse': 6265,
    'Saxon': 6141,
    'Schaffhausen': 2939,
    'Schattdorf': 1213,
    'Schenkon': 1099,
    'Scherzingen': 4691,
    'Schindellegi': 1321,
    'Schlatt (TG)': 4546,
    'Schleitheim': 2952,
    'Schlieren': 247,
    'Schmerikon': 3338,
    'Schmitten': 2305,
    'Schneisingen': 4318,
    'Schongau': 1041,
    'Schwarzenbach': 954,
    'Schwarzenburg': 855,
    'Schwerzenbach': 197,
    'Schwyz': 1372,
    'Schänis': 3315,
    'Schöftland': 4144,
    'Schönbühl': 544,
    'Schönenwerd': 2583,
    'Schötz': 1143,
    'Schüpfheim': 1008,
    'Scuol': 3762,
    'Sedrun': 3986,
    'Seelisberg': 1215,
    'Seengen': 4208,
    'Seewen': 1372,
    'Segl': 3789,
    'Sempach': 1102,
    'Sempach Station': 1093,
    'Seon': 4209,
    'Siebnen': 1346,
    'Sierre': 6248,
    'Sierre/Siders': 6248,
    'Sins': 4239,
    'Sion': 6266,
    'Sirnach': 4761,
    'Sisseln': 4177,
    'Solothurn': 2601,
    'Sonvico': 5192,
    'Splügen': 3714,
    'Spreitenbach': 4040,
    'St-Luc': 6252,
    'St. Gallen': 3203,
    'St. Margrethen': 3236,
    'St.Gallen': 3203,
    'Stabio': 5266,
    'Stadel b. Niederglatt': 100,
    'Stallikon': 13,
    'Stans': 1509,
    'Stansstad': 1510,
    'Steckborn': 4864,
    'Steffisburg': 939,
    'Stein SG': 3360,
    'Stein am Rhein': 2964,
    'Steinen': 1373,
    'Steinhausen': 1708,
    'Stettlen': 358,
    'Stierva': 3542,
    'Strengelbach': 4285,
    'Studen': 749,
    'Studen BE': 749,
    'Studen SZ': 1375,
    'Stäfa': 158,
    'Sugiez': 2284,
    'Suhr': 4012,
    'Sulgen': 4506,
    'Sumiswald': 957,
    'Surrein': 3985,
    'Sursee': 1103,
    'Tavannes': 713,
    'Taverne-Torricella': 5227,
    'Thal': 3237,
    'Thalwil': 141,
    'Thayngen': 2920,
    'Thun': 942,
    'Thônex': 6640,
    'Thörishaus': 355,
    'Tramelan': 446,
    'Tremona': 5254,
    'Triengen': 1104,
    'Trimbach': 2500,
    'Trimmis': 3945,
    'Trin': 3734,
    'Trogen': 3025,
    'Trélex': 5730,
    'Trüllikon': 40,
    'Turbenthal': 228,
    'Tägerwilen': 4696,
    'Täuffelen': 751,
    'Ueken': 4179,
    'Uerkheim': 4286,
    'Uetendorf': 944,
    'Uitikon Waldegg': 248,
    'Unterentfelden': 4013,
    'Unteriberg': 1375,
    'Unterkulm': 4146,
    'Unterägeri': 1709,
    'Urdorf': 250,
    'Urnäsch': 3006,
    'Uster': 198,
    'Uttigen': 885,
    'Utzenstorf': 552,
    'Uvrier': 6266,
    'Uznach': 3339,
    'VOI': 355,
    'Vacallo': 5268,
    'Vercorin': 6232,
    'Vernier': 6643,
    'Versoix': 6644,
    'Vevey': 5890,
    'Vicques': 6730,
    'Viganello': 5192,
    'Vignogn': 3618,
    'Villars-sur-Glâne': 2228,
    'Villars-sur-Ollon': 5409,
    'Visp': 6297,
    'Vitznau': 1068,
    'Volketswil': 199,
    'Vouvry': 6159,
    'Wabern': 355,
    'Wald ZH': 120,
    'Wallenried': 2254,
    'Wallisellen': 69,
    'Wangen an der Aare': 992,
    'Watt': 96,
    'Wattwil': 3379,
    'Weggis': 1069,
    'Weiach': 102,
    'Weinfelden': 4946,
    'Wettingen': 4045,
    'Wettswil': 14,
    'Wetzikon': 121,
    'Wetzikon (ZH)': 121,
    'Wichtrach': 632,
    'Wil SG': 3427,
    'Wildberg': 182,
    'Wildegg': 4203,
    'Wilen bei Wil': 4786,
    'Willisau': 1151,
    'Windisch': 4123,
    'Winkel': 72,
    'Winterthur': 230,
    'Wittenbach': 3204,
    'Wohlen': 4082,
    'Wolfhalden': 3038,
    'Wolfhausen': 112,
    'Wolhusen': 1009,
    'Wollerau': 1323,
    'Worb': 627,
    'Wädenswil': 293,
    'Würenlingen': 4047,
    'Yverdon-les-Bains': 5938,
    'Yvonand': 5939,
    'Zell': 1150,
    'Zermatt': 6300,
    'Zihlschlacht': 4511,
    'Zillis': 3712,
    'Zimmerwald': 888,
    'Zofingen': 4289,
    'Zollikofen': 361,
    'Zuchwil': 2534,
    'Zug': 1711,
    'Zumikon': 160,
    'Zuoz': 3791,
    'Zwingen': 2793,
    'Zäziwil': 628,
    'Zürich': 261,
    'wald': 120
}

locations = {
    "Zürich": 261,
    "Kloten": 62,
    "Uster": 198,
    "Illnau-Effretikon": 296,
    "Feuerthalen": 27,
    "Pfäffikon": 177,
    "Ottenbach": 11,
    "Dübendorf": 191,
    "Richterswil": 138,
    "Maur": 195,
    "Embrach": 56,
    "Bülach": 53,
    "Winterthur": 230,
    "Oetwil am See": 157,
    "Russikon": 178,
    "Obfelden": 10,
    "Wald (ZH)": 120,
    "Niederweningen": 91,
    "Dällikon": 84,
    "Buchs (ZH)": 83,
    "Rüti (ZH)": 118,
    "Hittnau": 173,
    "Bassersdorf": 52,
    "Glattfelden": 58,
    "Opfikon": 66,
    "Hinwil": 117,
    "Regensberg": 95,
    "Langnau am Albis": 136,
    "Dietikon": 243,
    "Erlenbach (ZH)": 151,
    "Kappel am Albis": 6,
    "Stäfa": 158,
    "Zell (ZH)": 231,
    "Turbenthal": 228,
    "Oberglatt": 92,
    "Winkel": 72,
    "Volketswil": 199,
    "Kilchberg (ZH)": 135,
    "Wetzikon (ZH)": 121,
    "Zumikon": 160,
    "Weisslingen": 180,
    "Elsau": 219,
    "Hettlingen": 221,
    "Rüschlikon": 139,
    "Stallikon": 13,
    "Dielsdorf": 86,
    "Wallisellen": 69,
    "Dietlikon": 54,
    "Meilen": 156,
    "Wangen-Brüttisellen": 200,
    "Flaach": 28,
    "Regensdorf": 96,
    "Niederhasli": 90,
    "Bauma": 297,
    "Aesch (ZH)": 241,
    "Schlieren": 247,
    "Dürnten": 113,
    "Unterengstringen": 249,
    "Gossau (ZH)": 115,
    "Oberengstringen": 245,
    "Schleinikon": 98,
    "Aeugst am Albis": 1,
    "Rheinau": 38,
    "Höri": 60,
    "Rickenbach (ZH)": 225,
    "Rafz": 67,
    "Adliswil": 131,
    "Zollikon": 161,
    "Urdorf": 250,
    "Hombrechtikon": 153,
    "Birmensdorf (ZH)": 242,
    "Fehraltorf": 172,
    "Weiach": 102,
    "Männedorf": 155,
    "Küsnacht (ZH)": 154,
    "Hausen am Albis": 4,
    "Hochfelden": 59,
    "Fällanden": 193,
    "Greifensee": 194,
    "Mönchaltorf": 196,
    "Dägerlen": 214,
    "Thalheim an der Thur": 39,
    "Uetikon am See": 159,
    "Seuzach": 227,
    "Uitikon": 248,
    "Affoltern am Albis": 2,
    "Geroldswil": 244,
    "Niederglatt": 89,
    "Thalwil": 141,
    "Rorbas": 68,
    "Pfungen": 224,
    "Weiningen (ZH)": 251,
    "Bubikon": 112,
    "Neftenbach": 223,
    "Mettmenstetten": 9,
    "Otelfingen": 94,
    "Flurlingen": 29,
    "Stadel": 100,
    "Grüningen": 116,
    "Henggart": 31,
    "Dachsen": 25,
    "Bonstetten": 3,
    "Bachenbülach": 51,
    "Horgen": 295
}


def predict_price(rooms, area, town):
    # Ermittle den BFS-Code der Wohnlage
    loc_bfs = locations.get(town)
    if loc_bfs is None:
        return f"Ort '{town}' nicht in locations gefunden."
    
    # Prüfe, ob im Eingabeort auch ein Supermarkt verzeichnet ist
    supermarket_bfs = supermarket_locations.get(town, None)
    
    # Filtere den Datensatz anhand des BFS-Codes der Wohnlage
    df = df_bfs_data[df_bfs_data['bfs_number'] == loc_bfs].copy()
    if df.empty or len(df) != 1:
        return f"Kein eindeutiger Datensatz für BFS-Code {loc_bfs} gefunden."
    
    df.reset_index(drop=True, inplace=True)
    df.loc[0, 'rooms'] = rooms
    df.loc[0, 'area'] = area

    # Führe die Vorhersage mittels des Random Forest Modells durch
    base_prediction = random_forest_model.predict(
        df[['rooms', 'area', 'pop', 'pop_dens', 'frg_pct', 'emp', 'tax_income']]
    )
    predicted_price = np.round(base_prediction[0], 0)
    
    # Falls ein Supermarkt im gleichen Ort gefunden wurde, füge z. B. ein 5%-Premium hinzu
    if supermarket_bfs is not None:
        predicted_price *= 1.05

    return predicted_price

def predict_price_interface(rooms, area, town):
    price = predict_price(rooms, area, town)
    return f"Geschätzter Preis: {price}"

# Erstelle das Gradio-Interface
iface = gr.Interface(
    fn=predict_price_interface,
    inputs=[
        gr.Number(label="Anzahl der Zimmer", value=3),
        gr.Number(label="Fläche (m²)", value=80),
        gr.Dropdown(choices=locations.keys(), 
            label="Region", type="value")],
            
    outputs="text",
    title="Wohnungspreis Vorhersage",
    description=("Berechnet den geschätzten Preis basierend auf der Anzahl der Zimmer, "
                 "der Fläche und dem Wohnort. Liegt im gleichen Ort ein Supermarkt vor, "
                 "wird ein Premium auf den Preis aufgeschlagen.")
)

iface.launch()